<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Split-Flap Clock | NetHealth 2025</title>
  
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon/apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon/favicon-96x96.png') }}">
  <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon/favicon.ico') }}" />
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-family: Inter, Arial, sans-serif;
      background: #1b1b1b;
      color: #eaeaea;
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    /* Light mode */
    body.light-ui {
      background: #f6f7f8;
      color: #1b1b1b;
    }
    
    /* Back button */
    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.15);
      background: rgba(0,0,0,.55);
      color: #eaeaea;
      font: 600 14px/1.1 Inter, system-ui, sans-serif;
      cursor: pointer;
      backdrop-filter: blur(6px);
      transition: all 0.3s ease;
      text-decoration: none;
      z-index: 100;
    }
    
    .back-btn:hover {
      background: rgba(0,0,0,.7);
      transform: translateY(-2px);
    }
    
    .back-btn i {
      color: #3B82F6;
    }
    
    body.light-ui .back-btn {
      border-color: rgba(0,0,0,.15);
      background: rgba(255,255,255,.7);
      color: #222;
    }
    
    body.light-ui .back-btn:hover {
      background: rgba(255,255,255,.9);
    }
    
    /* Mode toggle button */
    .mode-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.15);
      background: rgba(0,0,0,.55);
      color: #eaeaea;
      font: 600 14px/1.1 Inter, system-ui, sans-serif;
      cursor: pointer;
      backdrop-filter: blur(6px);
      transition: all 0.3s ease;
      z-index: 100;
    }
    
    .mode-toggle:hover {
      background: rgba(0,0,0,.7);
      transform: translateY(-2px);
    }
    
    body.light-ui .mode-toggle {
      border-color: rgba(0,0,0,.15);
      background: rgba(255,255,255,.7);
      color: #222;
    }
    
    body.light-ui .mode-toggle:hover {
      background: rgba(255,255,255,.9);
    }
    
    .mode-toggle .icon { font-size: 18px; }
    body.light-ui .mode-toggle .icon { color: #f59e0b; }
    .mode-toggle .icon { color: #1e3a8a; }
    
    /* Clock container */
    .clock-wrapper {
      position: relative;
      display: inline-block;
    }
    
    .splitflap.clock {
      display: inline-flex;
      align-items: flex-end;
      gap: 2px;
      font-size: 90px;
      transition: font-size 0.05s linear;
    }
    
    body.light-ui .splitflap.clock {
      background: rgba(255,255,255,.7);
      padding: 0.22em 0.33em;
      border-radius: 0.16em;
      box-shadow: 0 0.067em 0.267em rgba(0,0,0,.06);
    }
    
    /* Resize handle */
    .resize-handle {
      position: absolute;
      bottom: -15px;
      right: -15px;
      width: 30px;
      height: 30px;
      background: rgba(255,255,255,.1);
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      cursor: nwse-resize;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      opacity: 0.6;
      transition: opacity 0.2s, background 0.2s;
      user-select: none;
    }
    
    .resize-handle:hover {
      opacity: 1;
      background: rgba(255,255,255,.2);
    }
    
    .resize-handle:active {
      background: rgba(255,255,255,.3);
    }
    
    body.light-ui .resize-handle {
      background: rgba(0,0,0,.05);
      border-color: rgba(0,0,0,.2);
      color: #333;
    }
    
    body.light-ui .resize-handle:hover {
      background: rgba(0,0,0,.1);
    }
    
    /* Segment (digit container) */
    .splitflap .segment {
      position: relative;
      display: inline-block;
      width: 1.22em;
      margin: 0 0.044em;
    }
    
    .splitflap .clock .ampm {
      width: 0.78em;
      margin-left: 0.067em;
      font-size: 0.267em;
    }
    
    /* Colon separator */
    .colon {
      display: inline-block;
      width: 0.4em;
      margin: 0 0.011em;
      font-weight: 700;
      opacity: 0.85;
    }
    
    /* Top and bottom halves */
    .splitflap .segment ol {
      padding: 0;
      margin: 0;
      position: relative;
      list-style: none;
    }
    
    .splitflap .segment ol.top {
      margin-bottom: 0.03em;
      line-height: 1;
    }
    
    /* Individual flap */
    .splitflap .segment li {
      position: absolute;
      display: block;
      top: 0;
      left: 0;
      overflow: hidden;
      text-align: center;
      height: 0.48em;
      width: 100%;
      font-family: "Space Mono", "Courier New", monospace;
      font-weight: 700;
      text-transform: none;
    }
    
    .splitflap .top li:first-child { position: static; }
    .splitflap .bottom li:last-child { position: static; }
    
    /* Top half styling */
    .splitflap .top li {
      background: #000;
      color: #fff;
      border-top-left-radius: 7px;
      border-top-right-radius: 7px;
      -webkit-transform: scaleY(1);
      transform: scaleY(1);
      -webkit-transform-origin: 50% 100%;
      transform-origin: 50% 100%;
      -webkit-transition: -webkit-transform 110ms 0 ease-out;
      transition: transform 110ms 0ms ease-out;
    }
    
    .splitflap .top li.falling {
      -webkit-transform: scaleY(0);
      transform: scaleY(0);
    }
    
    /* Bottom half styling */
    .splitflap .bottom li {
      background: #0f0f0f;
      color: #e6e6e6;
      line-height: 0;
      border-bottom-left-radius: 7px;
      border-bottom-right-radius: 7px;
      -webkit-transform: scaleY(0);
      transform: scaleY(0);
      -webkit-transform-origin: 50% 0;
      transform-origin: 50% 0;
      -webkit-transition: -webkit-transform 100ms 60ms ease-in;
      transition: transform 100ms 60ms ease-in;
    }
    
    .splitflap .bottom li.current,
    .splitflap .bottom li.falling {
      -webkit-transform: scaleY(1);
      transform: scaleY(1);
    }
    
    /* Light mode flap colors */
    body.light-ui .splitflap .top li {
      background: #2a2a2a;
      color: #fff;
    }
    
    body.light-ui .splitflap .bottom li {
      background: #1f1f1f;
      color: #f0f0f0;
    }
    
    /* AM/PM specific sizing */
    .splitflap .clock .ampm li {
      line-height: 1.1 !important;
      letter-spacing: -0.02em;
    }
    
    .splitflap:after {
      content: " ";
      display: table;
      clear: both;
    }
    
    /* Date display */
    .clock-date {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.1rem;
      color: rgba(255,255,255,0.5);
      font-weight: 500;
      text-align: center;
    }
    
    body.light-ui .clock-date {
      color: rgba(0,0,0,0.5);
    }
    
    /* Branding */
    .clock-branding {
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 8px;
      color: rgba(255,255,255,0.4);
      font-size: 0.85rem;
    }
    
    body.light-ui .clock-branding {
      color: rgba(0,0,0,0.4);
    }
    
    .clock-branding img {
      height: 1.25rem;
      width: auto;
      opacity: 0.5;
    }
    
    /* Responsive */
    @media (max-width: 600px) {
      .back-btn span,
      .mode-toggle .label {
        display: none;
      }
      
      .back-btn,
      .mode-toggle {
        padding: 10px;
      }
      
      .mode-toggle {
        top: 15px;
        right: 15px;
      }
      
      .back-btn {
        top: 15px;
        left: 15px;
      }
      
      .clock-branding {
        bottom: 50px;
        font-size: 0.75rem;
      }
      
      .clock-date {
        bottom: 20px;
        font-size: 0.95rem;
      }
    }
    
    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .splitflap .top li,
      .splitflap .bottom li {
        transition: none !important;
      }
    }
  </style>
</head>
<body>
  <!-- Back to Dashboard -->
  <a href="{{ url_for('index') }}" class="back-btn" title="Back to Dashboard">
    <i class="fas fa-arrow-left"></i>
    <span>Dashboard</span>
  </a>
  
  <!-- Mode toggle -->
  <button class="mode-toggle" id="mode-toggle" aria-label="Toggle theme">
    <i class="fas fa-moon icon"></i>
    <span class="label">Dark</span>
  </button>
  
  <!-- Clock -->
  <div class="clock-wrapper">
    <div id="clock" class="splitflap clock" role="timer" aria-live="off">
      <div class="segment hours"></div>
      <span class="colon">:</span>
      <div class="segment minutes"></div>
      <span class="colon">:</span>
      <div class="segment seconds"></div>
      <div class="segment ampm"></div>
    </div>
    <div class="resize-handle" id="resizeHandle" title="Drag to resize">â‡²</div>
  </div>
  
  <!-- Branding -->
  <div class="clock-branding">
    <img src="{{ url_for('static', filename='img/nethealth2025_logo.png') }}" alt="NetHealth 2025" />
    <span>NetHealth 2025</span>
  </div>
  
  <!-- Date -->
  <div class="clock-date" id="clockDate"></div>
  
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
  
  <script>
    // Split-flap widget
    (function ($) {
      function strToMs(timeString) {
        var matchTime = /([.0-9]*)([a-z]*)/i,
            match = matchTime.exec(timeString),
            base  = match[1];
        if (match[2] === "s") base = parseFloat(base) * 1000;
        else base = parseInt(base, 10);
        return Math.ceil(base);
      }

      function numRange(start, end) {
        function lzpad(string, paddedlen) {
          var padamt = paddedlen - string.length, o;
          if (padamt > 0) {
            for (o = new Array; padamt > 0; o[--padamt] = "0");
            return (o.join("") + string);
          }
          return string;
        }
        var i, zeropad = 0, output = [];
        if (start.charAt(0) === "0") zeropad = start.length;
        for (i = parseInt(start, 10); i <= parseInt(end, 10); i++) {
          output.push(lzpad(i.toString(), zeropad));
        }
        return output;
      }

      var glyphSets = {
        twelve    : numRange("1", "12"),
        twentyfour: numRange("0", "23"),
        minutes   : numRange("00", "59")
      };

      var defaults = {
        tickLength: 120,
        glyphSet: glyphSets.alphanumeric,
        initial: "",
        defaultSegments: 5
      };

      function flap(value) { return $("<li>" + value + "</li>"); }

      function segment(display, element, options) {
        if (!element) {
          if (display.suppliedElements && !options.dryrun) {
            element = display.suppliedElements.eq(display.segments.length);
          } else {
            element = $('<div class="segment"></div>');
            display.element.append(element);
          }
        }
        this.element = element;

        var glyphSet      = display.options.glyphSet,
            glyphSetIndex = element.data("glyphSetIndex");
        if (!options.dryrun && glyphSetIndex !== undefined) glyphSet = glyphSet[glyphSetIndex];
        else glyphSet = glyphSet[0];

        this.ignoreCase = !(/A-Z/.test(glyphSet) && /a-z/.test(glyphSet));

        this.top = $('<ol class="top"></ol>');    $.extend(this.top, { currentFlap: null });
        this.bot = $('<ol class="bottom"></ol>'); $.extend(this.bot, { currentFlap: null });
        element.append(this.top, this.bot);

        if (options.dryrun) { this.top.append(flap("")); this.bot.append(flap("")); return; }

        var self = this;
        this.display  = display;
        this.glyphSet = glyphSet;
        if (!options.initial) options.initial = glyphSet[0];
        this.target = options.initial;

        var i, z, targetIndex = this.glyphSet.indexOf(this.target);
        if (targetIndex === -1) targetIndex = 0;

        function wrap(val) { return (val + self.glyphSet.length) % self.glyphSet.length; }

        for (i = display.segTopLifespan - 1; i >= 0; i--) {
          z = wrap(i + targetIndex - display.segTopLifespan);
          this.top.append(flap(glyphSet[z]).css("display", "none"));
        }
        for (i = display.segBotLifespan - 1; i >= 0; i--) {
          z = wrap(i + targetIndex - display.segBotLifespan);
          this.bot.prepend(flap(glyphSet[z]).css("display", "none"));
        }
        for (i = 0; i < display.cacheFrames; i++) {
          z = wrap(i + targetIndex);
          this.top.prepend(flap(glyphSet[z]));
          this.bot.append(flap(glyphSet[z]));
        }

        this.top.currentFlap = this.top.children().eq(display.cacheFrames - 1);
        this.bot.currentFlap = this.bot.children().eq(-display.cacheFrames);
        this.bot.currentFlap.addClass("current");

        this.lastLoaded = wrap(targetIndex + display.cacheFrames - 2);
        this.flipping   = false;
      }

      segment.prototype.flipTo = function (glyph) {
        var self = this,
            glyphMatcher = new RegExp(glyph, this.ignoreCase ? "i" : undefined),
            setContains  = false, i;

        for (i = 0; i < this.glyphSet.length; i++) {
          if (glyphMatcher.test(this.glyphSet[i])) { setContains = true; break; }
        }
        if (!setContains) return;

        this.target = glyph;

        if (!this.flipping) {
          this.flipping = true;
          (function inner(){
            if (!glyphMatcher.exec(self.top.currentFlap.text())) {
              self.flip();
              setTimeout(inner, self.display.options.tickLength);
            } else {
              self.flipping = false;
            }
          })();
        }
      };

      segment.prototype.flip = function () {
        this.lastLoaded = (this.lastLoaded + 1) % this.glyphSet.length;

        this.top.currentFlap.addClass("falling");
        this.top.currentFlap.siblings().last().remove();
        this.top.currentFlap.parent().prepend(flap(this.glyphSet[this.lastLoaded]));
        this.top.currentFlap = this.top.currentFlap.prev();

        this.bot.currentFlap.addClass("falling");
        this.bot.currentFlap.siblings().first().remove();
        this.bot.currentFlap.parent().append(flap(this.glyphSet[this.lastLoaded]));
        this.bot.currentFlap = this.bot.currentFlap.next();
        this.bot.currentFlap.addClass("current");
      };

      $.widget("splitflap.splitflap", {
        options: defaults,

        _create: function () {
          if (!this.element.hasClass("splitflap")) this.element.addClass("splitflap");

          this.suppliedElements = this.element.find(".segment");
          if (this.suppliedElements.length) {
            this.options.segments = Math.max(this.options.segments || 0, this.suppliedElements.length);
          } else {
            this.suppliedElements = undefined;
          }

          if (!this.options.segments) {
            if (this.options.initial) this.options.segments = this.options.initial.length;
            else if (this.suppliedElements) this.options.segments = this.suppliedElements.length;
            else this.options.segments = this.options.defaultSegments;
          }

          this.cacheFrames = 2;

          if (typeof this.options.glyphSet === "string") {
            this.options.glyphSet = [this.options.glyphSet.split("")];
          } else if (this.options.glyphSet.length === undefined) {
            var i = 0, indexed = [];
            for (var s in this.options.glyphSet) {
              indexed.push(this.options.glyphSet[s]);
              this.element.find(s).filter(".segment").data("glyphSetIndex", i);
              i += 1;
            }
            this.options.glyphSet = indexed;
          } else {
            this.options.glyphSet = [this.options.glyphSet];
          }

          var tempSeg = new segment(this, null, { dryrun: true }),
              tempHtml = tempSeg.element,
              topFlap  = tempSeg.top.children().first(),
              botFlap  = tempSeg.bot.children().first();

          this.stylePrefix = "";
          if (topFlap.css("-webkit-transition-duration")) this.stylePrefix = "-webkit-";

          this.segTopLifespan = Math.floor(
            strToMs(topFlap.css(this.stylePrefix + "transition-duration")) / this.options.tickLength
          ) + 1;

          this.segBotLifespan = Math.floor(
            (strToMs(botFlap.css(this.stylePrefix + "transition-duration")) +
             strToMs(botFlap.css(this.stylePrefix + "transition-delay"))) / this.options.tickLength
          ) + 2;

          tempHtml.remove();

          this.segments = [];
          for (var j = 0; j < this.options.segments; j++) {
            this.segments[j] = new segment(this, null, { initial: this.options.initial[j] });
          }
        },

        value: function (value) {
          if (value === undefined) {
            var out = [];
            for (var i = 0; i < this.segments.length; i++) out.push(this.segments[i].target);
            return out.join("");
          }

          if (typeof value === "string") value = value.split("");

          for (var v = 0; v < value.length; v++) value[v] = value[v].replace(" ", "\u00A0");

          for (var k = 0; k < Math.min(value.length, this.segments.length); k++) {
            this.segments[k].flipTo(value[k]);
          }
          for (k = value.length; k < this.segments.length; k++) {
            this.segments[k].flipTo(this.segments[k].glyphSet[0]);
          }
        }
      });

      $.splitflap = $.splitflap || {};
      $.extend(true, $.splitflap, glyphSets);

    })(jQuery);
    
    // App initialization
    $(function () {
      // Dark/Light mode toggle - sync with main dashboard
      const MODE_KEY = "nh.mode";
      const prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches;

      function applyMode(mode){
        const isLight = mode === "light";
        $("body").toggleClass("light-ui", isLight);
        $("#mode-toggle .icon").removeClass("fa-moon fa-sun").addClass(isLight ? "fa-sun" : "fa-moon");
        $("#mode-toggle .label").text(isLight ? "Light" : "Dark");
      }

      const savedMode = localStorage.getItem(MODE_KEY) || (prefersLight ? "light" : "dark");
      applyMode(savedMode);

      $("#mode-toggle").on("click", function(){
        const next = $("body").hasClass("light-ui") ? "dark" : "light";
        applyMode(next);
        localStorage.setItem(MODE_KEY, next);
      });

      // Date display
      function formatDate() {
        const now = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        return now.toLocaleDateString('en-US', options);
      }
      
      $("#clockDate").text(formatDate());

      // Clock setup
      function clockParts(d){
        let h = d.getHours();
        const ampm = h >= 12 ? "PM" : "AM";
        h = h % 12 || 12;
        return [
          String(h),
          String(d.getMinutes()).padStart(2, "0"),
          String(d.getSeconds()).padStart(2, "0"),
          ampm
        ];
      }

      const $clock = $("#clock").splitflap({
        glyphSet: {
          ".hours"  : $.splitflap.twelve,
          ".minutes": $.splitflap.minutes,
          ".seconds": $.splitflap.minutes,
          ".ampm"   : ["AM", "PM"]
        },
        initial: clockParts(new Date())
      });

      (function tick(){
        $clock.splitflap("value", clockParts(new Date()));
        
        // Update date at midnight
        const now = new Date();
        if (now.getHours() === 0 && now.getMinutes() === 0 && now.getSeconds() === 0) {
          $("#clockDate").text(formatDate());
        }
        
        setTimeout(tick, 1000 - (Date.now() % 1000));
      })();

      // Resize functionality
      const SCALE_KEY = "nh.clockScale";
      const $clockElement = $("#clock");
      const $resizeHandle = $("#resizeHandle");
      
      let startY, startFontSize;
      const minSize = 30;
      const maxSize = 200;
      
      // Load saved scale
      const savedScale = localStorage.getItem(SCALE_KEY);
      if (savedScale) {
        $clockElement.css("font-size", savedScale + "px");
      }
      
      $resizeHandle.on("mousedown", function(e) {
        e.preventDefault();
        startY = e.clientY;
        startFontSize = parseInt($clockElement.css("font-size"));
        
        $(document).on("mousemove", onMouseMove);
        $(document).on("mouseup", onMouseUp);
        $("body").css("cursor", "nwse-resize");
      });
      
      // Touch support for mobile
      $resizeHandle.on("touchstart", function(e) {
        e.preventDefault();
        startY = e.touches[0].clientY;
        startFontSize = parseInt($clockElement.css("font-size"));
        
        $(document).on("touchmove", onTouchMove);
        $(document).on("touchend", onTouchEnd);
      });
      
      function onMouseMove(e) {
        const deltaY = startY - e.clientY;
        const newSize = Math.min(maxSize, Math.max(minSize, startFontSize + deltaY));
        $clockElement.css("font-size", newSize + "px");
      }
      
      function onTouchMove(e) {
        const deltaY = startY - e.touches[0].clientY;
        const newSize = Math.min(maxSize, Math.max(minSize, startFontSize + deltaY));
        $clockElement.css("font-size", newSize + "px");
      }
      
      function onMouseUp() {
        $(document).off("mousemove", onMouseMove);
        $(document).off("mouseup", onMouseUp);
        $("body").css("cursor", "");
        
        const finalSize = parseInt($clockElement.css("font-size"));
        localStorage.setItem(SCALE_KEY, finalSize);
      }
      
      function onTouchEnd() {
        $(document).off("touchmove", onTouchMove);
        $(document).off("touchend", onTouchEnd);
        
        const finalSize = parseInt($clockElement.css("font-size"));
        localStorage.setItem(SCALE_KEY, finalSize);
      }
    });
  </script>
</body>
</html>